view "cn" {
match-clients { cn; };

dlz "Mysql zone" {
    database "mysql
        {host=10.100.240.135 dbname=bind_ui ssl=false port=3306 user=bind_ui_r pass=Rr123456!}
        {select zone_name from DnsRecord_zonetag where zone_name = '$zone$'}
        {select ttl, type, mx_priority, 
            case when lower(type)='txt' then
                concat('\"', data, '\"')
            when lower(type) = 'soa' then
                concat_ws(' ', data, mail, serial, refresh, retry, expire, minimum)
            else
                data
            end
            from DnsRecord_zonetag inner join DnsRecord_record on DnsRecord_record.zone_tag_id = DnsRecord_zonetag.id
                and DnsRecord_zonetag.zone_name = '$zone$'
                and DnsRecord_record.host = '$record$'
                where DnsRecord_zonetag.status = 'on'
                    and DnsRecord_record.status = 'on'
                    and DnsRecord_record.basic not in (200, 301, 302)
                    and (DnsRecord_record.resolution_line = 'cn' or DnsRecord_record.resolution_line = '0')
        }
    ";
};

};
